# 【Effective Modern C++】第四章：智能指针

作者：wallace-lai </br>
发布：2024-02-28 </br>
更新：2024-02-28 </br>

C++中的裸指针功能强大，但稍有不慎极易伤及自身。裸指针有以下这些常见的可怕之处：

（1）它的声明无法指示它到底是个对象还是个数组

```cpp
int *p1 = new int;
int *p2 = new int[16];  // 对象与数组无法区分
```

（2）它的声明没有告诉你是否应该销毁它，即指针是否拥有所指之物（即指针所指对象的归属权是否属于该指针）

```cpp
void f(int *p)
{
    // use p
    delete p    // 我应该销毁该指针所指对象吗？不知道
}
```

（3）如果你决定你应该销毁指针所指向对象，没人告诉你该用delete还是其它的析构机制


（4）接着（3），如果是用delete销毁，是delete单个对象还是delete数组，无法确定

```cpp
void f(int *p)
{
    // use p
    // 使用 delete 还是其它的析构机制？不知道
    // 即使确定使用delete，那么是delete单个对象还是delete数组？不知道
}
```

（5）即使你能够正确销毁指针所指对象，但你很难确定你**在所有执行路径上（包括异常路径）都恰好执行了一次销毁操作**。少一次路径可能会导致泄露，而多销毁一次会导致未定义行为

（6）一般来讲没有办法告诉你指针是否变成了悬空指针

```cpp
void f(int *p)
{
    // use p
    // ...
}

int *p = new int;

// use p

delete p;

f(p);   // p已经成为了悬空指针，但是f不知道
```

综上所述：裸指针很危险，极容易造成内存泄露和各种未定义行为，我们需要智能指针

## 条款18：对于独占资源使用unique_ptr

未完待续
